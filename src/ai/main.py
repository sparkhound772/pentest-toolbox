from openai import OpenAI
import sys
import argparse

def main():
    parser = argparse.ArgumentParser("Chat with GPT:s from either OpenAI or Ollama")
    parser.add_argument('--sysm', help='String or file containing string')
    parser.add_argument('-v', '--version', action='version', version='0.1 Prototype', help="Show the version of the program and exit")
    args = parser.parse_args()

    client = OpenAI()

    system_message = args.sysm

    message = sys.stdin.read().strip()

    # type(response_dict_ai) --> <class 'openai.types.chat.chat_completion.ChatCompletion'>
    response_object = call_ai(client, system_message, message)

    response_dict = response_object.model_dump()

    response_string = response_dict["choices"][0]["message"]["content"]

    print(response_string)


def call_ai(client, system_message, message):
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {
                "role": "system",
                "content": system_message 
            },
            {
                "role": "user",
                "content": message
            }
        ]
    )
    
    return response
    
if __name__ == "__main__":
    main()

