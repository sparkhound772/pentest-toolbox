import os
import sys
import requests
from urllib.parse import urlparse, unquote

def ensure_dir(directory):
    if not os.path.exists(directory):
        os.makedirs(directory)

def download_file(url):
    try:
        response = requests.get(url, stream=True)
        if response.status_code == 200:
            parsed_url = urlparse(url)
            path = unquote(parsed_url.path)
            local_file_path = os.path.join('downloads', path.lstrip('/'))
            
            ensure_dir(os.path.dirname(local_file_path))
            
            with open(local_file_path, 'wb') as file:
                for chunk in response.iter_content(chunk_size=8192):
                    file.write(chunk)
            # Comment out or remove the print statement for silent operation
            # print(f"Downloaded: {url} -> {local_file_path}")
        else:
            print(f"Failed to download {url}: HTTP Status Code {response.status_code}", file=sys.stderr)
    except requests.RequestException as e:
        print(f"Error downloading {url}: {e}", file=sys.stderr)

def main():
    for line in sys.stdin:
        url = line.strip()
        if url:
            download_file(url)

if __name__ == "__main__":
    main()
